name: Keep Backend Alive

on:
  schedule:
    # Runs every 14 minutes to prevent Render free tier from spinning down
    # Render spins down after 15 minutes of inactivity
    - cron: '*/14 * * * *'
  
  # Allows manual trigger from GitHub Actions tab
  workflow_dispatch:

jobs:
  ping-backend:
    runs-on: ubuntu-latest
    
    steps:
      - name: Ping Backend Health Endpoint
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ”„ Keep-Alive Ping Started"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "â° Time: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
          echo "ğŸ¯ Target: https://studybuddy-backend-5ayj.onrender.com/api/health"
          echo ""
          
          # Ping the backend
          response=$(curl -s -o /dev/null -w "%{http_code}" \
            -m 30 \
            https://studybuddy-backend-5ayj.onrender.com/api/health)
          
          echo "ğŸ“Š Response Code: $response"
          echo ""
          
          # Check if successful
          if [ $response -eq 200 ]; then
            echo "âœ… Backend is alive and responding!"
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            exit 0
          else
            echo "âŒ Backend returned HTTP $response"
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            exit 1
          fi
      
      - name: Notify on Failure
        if: failure()
        run: |
          echo "âš ï¸  Backend health check failed!"
          echo "Please check your Render deployment."
